<!DOCTYPE html>
<html lang="en">
<head>
<title>AIO Smart-Home</title>
<style>
/* Add a black background color to the top navigation */
.topnav {
  background-color: #333;
  overflow: hidden;
}

/* Style the links inside the navigation bar */
.topnav a {
  float: left;
  color: #f2f2f2;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 17px;
}

/* Change the color of links on hover */
.topnav a:hover {
  background-color: grey;
  color: black;
}

/* Add a color to the active/current link */
.topnav a.active {
  background-color: white;
  color: black;
}
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #f9fbff, #eef3ff);
      color: #333;
      display: flex;
      flex-direction: column;
      padding: 20px;

    }
body.light {
    background: #f1f5f9;
    color: #111;
}
.box {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 20px;
      margin:20px;
      width: 300px;
      text-align: center;
    }
.longbox {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 10px;
      width: 900px;
      text-align: center;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
.value {
  font-size: 20px;
  font-weight: bold;

  margin: 5px 0;
}
.btn {
    padding: 8px 14px;
    background: black;
    color: white;
    text-decoration: none;
    border-radius: 4px;
margin-right: 10px
}
</style>
</head>
<body>
<div class="topnav">
  <a class="active" href="#home">Home</a>
  <a href="/log">Logs</a>


  <a href="/logout">Log out</a>
</div>
<div class = 'title'>
<h2>üè†Ô∏é AIO Smart-Home</h2>

<h5>Online, Hello {{user}}, House: {{house}}</h5>
</div>
<div class="grid">
  <div class="box">
    <h4>Mode</h4>
    <div>Value: <span class="value" id="mode"></span></div>
  </div>
  <div class="box">
    <h4>üå°Home Environment</h4>
    <div>Temperature: <span class="value" id="temp">--</span> </div>
    <div>Humidity: <span class="value" id="humid">--</span></div>
<div>Rain: <span class="value" id="rain">No</span></div>
  </div>
  <div class="box"> <h4>üîíÔ∏é Door Lock</h4><div><span class="value" id="lock">Locked</span></div>
<div>
</div> <div> Last access: <span class="value" id= "last_access">3/3/2000 25:22:222</span></div>
</div>

  <div class="box"> <h4>üí°Light</h4> <div><span class="value" id="light"></span></div>
<div>Auto: <span class="value" id="autolight">On</span></div><br><button id="togglelight"class= "btn">Toggle light</button><button id="toggleautolight"class= "btn">Toggle auto</button>
</div>
  <div class="box"> <h4>‚õà Window</h4> <div><span class="value" id="window">Open</span></div>

<div>Auto: <span class="value" id="window_auto">On</span> </div> <br><button id="togglewindow" class= "btn">Toggle window</button><button id="toggleautowindow"class= "btn">Toggle auto</button>
</div>
  <div class="longbox"><h4>Status:</h4><span class ="value" id="status">FIRE!</span><br><button id="resetalarm"class= "btn">Reset alarm</button></div>
<div class="longbox"><h4>House camera</h4><img id="latest-photo" src="{{ url_for('get_camera') }}" width="400" onerror="this.style.display='none'">
<br> <button id="takephoto"class= "btn">Take photo</button></div>


</div>


  <script>

async function fetchSensor(endpoint, elementId, unit = '') {

  fetch(endpoint)
            .then(response => response.text())
            .then(data => {
                document.getElementById(elementId).innerText = data + unit;
            })
            .catch(error => console.error('Error', error));

}

function colorchange(elementId,threshold){

//
const div = document.getElementById(elementId);
let val = parseInt(div.innerText);
if (val >threshold){
div.style.color = "red";
}
else {
div.style.color = "black";
}

}
// buttons
document.getElementById("togglelight").addEventListener("click", () => {
        fetch('/toggle_light')
});
document.getElementById("toggleautolight").addEventListener("click", () => {
        fetch('/autolight')
});
document.getElementById("togglewindow").addEventListener("click", () => {
        fetch('/toggle_window')
});

document.getElementById("toggleautowindow").addEventListener("click", () => {
        fetch('/autowindow')
});

document.getElementById("takephoto").addEventListener("click", () => {
        fetch('/takephoto')
});



document.getElementById("resetalarm").addEventListener("click", () => {
        fetch('/resetalarm')
});

async function updateSensors() {
  await fetchSensor('/temp', 'temp', ' ¬∞C');
  await fetchSensor('/humidity', 'humid', ' %');
  await fetchSensor('/mode', 'mode');
  await fetchSensor('/status', 'status');
  await fetchSensor('/lock', 'lock'); // plain text or boolean
  await fetchSensor('/lastaccess', 'last_access'); // plain text or boolean
  await fetchSensor('/light', 'light'); // plain text or boolean
  await fetchSensor('/lightmode', 'autolight'); // plain text or boolean
  await fetchSensor('/window', 'window'); // plain text or boolean
  await fetchSensor('/windowmode', 'window_auto'); // plain text or boolean
  await fetchSensor('/rain', 'rain'); // plain text or boolean
  colorchange('temp',50);
}
function refreshImage() {
    const img = document.getElementById('latest-photo');
    const timestamp = new Date().getTime(); // cache-busting
    // Call Flask route 'get_camera' instead of static file
    img.src = "{{ url_for('get_camera') }}" + "?v=" + timestamp;
    img.style.display = 'inline'; // show if it loads successfully
}

setInterval(refreshImage, 1000);
    setInterval(updateSensors, 1000);
    updateSensors(); // Initial call
  </script>
</body>


